# 工作区编程助手功能

## 概述

Glosc Copilot 现在支持类似 Claude Code、iFlow CLI 和 1Code 的高级编程助手功能。AI 可以直接读取、编辑和操作你的代码库，执行多步骤任务，并提供实时反馈。

## 核心功能

### 1. 智能文件系统操作

AI 助手可以通过 MCP (Model Context Protocol) 工具直接操作文件系统：

#### 支持的操作

- **读取文件** (`read_file`) - 查看任何文件的内容
- **写入文件** (`write_file`) - 创建新文件或覆盖现有文件
- **编辑文件** (`edit_file`) - 使用查找替换方式精确修改文件
- **列出目录** (`list_directory`) - 浏览目录结构
- **创建目录** (`create_directory`) - 创建新目录
- **删除文件** (`delete_file`) - 删除文件或空目录
- **搜索文件** (`search_files`) - 使用 glob 模式查找文件
- **内容搜索** (`grep_files`) - 在文件内容中搜索文本
- **移动文件** (`move_file`) - 重命名或移动文件

#### 使用示例

```
用户: 请帮我创建一个 Vue 组件 HelloWorld.vue

AI 会:
1. write_file(path="src/components/HelloWorld.vue", content="<template>...")
2. 确认文件已创建

用户: 找出所有使用 console.log 的地方

AI 会:
1. grep_files(pattern="console.log", filePattern="**/*.ts")
2. 列出所有匹配的文件和行号

用户: 把所有 console.log 改成 logger.info

AI 会:
1. 对每个文件调用 edit_file(path="...", search="console.log", replace="logger.info")
2. 确认所有修改
```

### 2. 任务规划和执行

类似 Claude Code 的"计划模式"，AI 会：

1. **分析需求** - 理解你要做什么
2. **制定计划** - 列出具体步骤
3. **逐步执行** - 按步骤完成任务
4. **实时反馈** - 显示每一步的执行状态

#### 任务执行界面

工作区提供了专门的任务执行视图：

- 显示任务步骤列表
- 实时更新执行状态
- 展示工具调用详情
- 错误提示和处理

### 3. 代码库上下文理解

AI 可以理解整个项目结构：

- 自动扫描工作区文件
- 分析项目依赖关系
- 理解代码组织结构
- 提供符合项目风格的建议

#### 文件上下文模式

在工作区会话设置中可选择：

- **无** - 不提供文件上下文
- **列表** - 仅提供文件列表
- **完整** - 包含文件内容摘要

### 4. 集成终端控制台

在工作区中可以：

- 执行命令行命令
- 查看命令输出
- 支持多个终端标签页
- 跨平台 shell 支持（bash, zsh, cmd, powershell）

### 5. Monaco 代码编辑器

内置强大的代码编辑器：

- 语法高亮
- 代码补全
- 快捷键支持
- 多语言支持

## 设置和配置

### 启用文件系统 MCP 服务器

1. 构建 MCP 服务器：

```bash
cd src/mcp-servers
yarn install
yarn build
```

2. 在 Glosc Copilot 中添加服务器配置：

   - 打开 MCP 配置页面
   - 点击"添加服务器"
   - 配置如下：

```json
{
  "name": "文件系统",
  "type": "stdio",
  "command": "node",
  "args": ["<项目路径>/src/mcp-servers/dist/filesystem-server.js"],
  "env": {
    "WORKSPACE_ROOT": "<你的工作区路径>"
  },
  "enabled": true
}
```

3. 保存并启动服务器

### 在工作区会话中启用 MCP 工具

1. 打开工作区页面
2. 打开一个工作区目录
3. 创建新会话
4. 在会话设置中：
   - 启用"文件系统" MCP 服务器
   - 选择文件上下文模式
   - 保存设置

## 使用场景

### 场景 1: 创建新功能

```
用户: 帮我创建一个用户认证功能，包括登录和注册

AI 会:
1. 分析项目结构
2. 创建必要的文件（组件、API、类型定义）
3. 实现登录和注册逻辑
4. 添加路由配置
5. 更新相关文档
```

### 场景 2: 重构代码

```
用户: 将 src/utils 目录下的所有工具函数改用 TypeScript

AI 会:
1. 列出所有 .js 文件
2. 逐个转换为 .ts
3. 添加类型定义
4. 更新导入语句
5. 验证类型正确性
```

### 场景 3: 批量修改

```
用户: 把所有组件中的 @click 改成 @click.prevent

AI 会:
1. 搜索所有 .vue 文件中的 @click
2. 逐个文件替换
3. 确认修改完成
```

### 场景 4: 项目分析

```
用户: 分析一下这个项目的结构，有哪些主要模块？

AI 会:
1. 列出目录结构
2. 识别关键文件和目录
3. 分析依赖关系
4. 提供项目概览
```

## 安全性

### 沙箱限制

- 所有文件操作限制在配置的工作区根目录内
- 不能访问系统敏感目录
- 文件大小限制（默认 10MB）
- 搜索结果数量限制

### 权限控制

- 需要显式启用 MCP 服务器
- 可以随时禁用特定工具
- 所有操作都有日志记录

## 与其他工具对比

| 特性 | Glosc Copilot | Claude Code | iFlow CLI | 1Code |
|------|---------------|-------------|-----------|-------|
| 文件操作 | ✅ | ✅ | ✅ | ✅ |
| 任务规划 | ✅ | ✅ | ✅ | ✅ |
| 图形界面 | ✅ | ❌ | ❌ | ✅ |
| 跨平台桌面 | ✅ | ❌ | ❌ | ⚠️ (macOS only) |
| MCP 扩展 | ✅ | ✅ | ✅ | ❌ |
| 中文界面 | ✅ | ❌ | ✅ | ❌ |
| 集成终端 | ✅ | ✅ | ✅ | ✅ |
| 实时预览 | ⚠️ (规划中) | ❌ | ❌ | ✅ |
| Git 集成 | ⚠️ (规划中) | ✅ | ✅ | ✅ |

## 最佳实践

### 1. 明确任务描述

```
❌ 差: "改一下这个文件"
✅ 好: "在 src/App.vue 中添加一个导航栏组件，包含首页、关于、联系三个链接"
```

### 2. 分步骤操作

对于复杂任务，建议分步提问：

```
1. "先分析一下这个项目的结构"
2. "好的，现在帮我创建一个新的用户模块"
3. "在用户模块中添加认证功能"
```

### 3. 验证结果

AI 完成操作后，可以要求：

```
"请显示刚才修改的文件内容"
"列出所有被修改的文件"
```

### 4. 使用版本控制

建议在 AI 执行大量修改前：

```
"先让我提交一下当前代码"
（手动 git commit）
然后再让 AI 进行修改
```

## 故障排除

### MCP 服务器无法启动

1. 检查 Node.js 版本（需要 18+）
2. 确认服务器已正确构建
3. 查看路径是否正确
4. 检查工作区目录权限

### 文件操作失败

1. 确认文件路径相对于工作区根目录
2. 检查文件权限
3. 确保路径中不包含特殊字符
4. 验证文件大小是否超限

### AI 无法理解项目结构

1. 启用"完整"文件上下文模式
2. 先让 AI "分析项目结构"
3. 提供更多上下文信息
4. 手动指定关键文件

## 未来计划

- [ ] Git 操作集成（commit, push, pull, diff）
- [ ] 代码审查和建议
- [ ] 自动化测试生成
- [ ] 实时预览和热重载
- [ ] 多人协作功能
- [ ] AI 代码解释和文档生成
- [ ] 性能分析和优化建议
- [ ] 安全漏洞扫描

## 反馈和贡献

如有问题或建议，欢迎：

- 提交 GitHub Issue
- 参与讨论
- 贡献代码

---

*最后更新: 2026-01-19*
